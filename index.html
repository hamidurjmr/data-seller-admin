<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Seller - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5a6fd8;
            --secondary: #764ba2;
            --success: #388e3c;
            --success-light: #e8f5e9;
            --warning: #f57c00;
            --warning-light: #fff3e0;
            --danger: #d32f2f;
            --danger-light: #ffebee;
            --info: #1976d2;
            --info-light: #e3f2fd;
            --dark: #2c3e50;
            --light: #f8f9fa;
            --gray: #7f8c8d;
            --border: #e9ecef;
        }

        html, body {
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        body {
            background: var(--light);
            color: var(--dark);
            min-height: 100%;
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 50px 40px;
            width: 100%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-icon {
            font-size: 70px;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .login-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: var(--gray);
            margin-bottom: 40px;
            line-height: 1.5;
            font-size: 16px;
        }

        .login-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 18px 40px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
        }

        .login-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .login-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        /* Admin Dashboard */
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .admin-header {
            background: white;
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .header-left p {
            color: var(--gray);
            font-size: 15px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 20px;
            overflow: hidden;
        }

        .admin-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .admin-info {
            text-align: right;
        }

        .admin-email {
            font-weight: 600;
            color: var(--dark);
            font-size: 15px;
            margin-bottom: 3px;
        }

        .admin-role {
            font-size: 13px;
            padding: 4px 12px;
            border-radius: 12px;
            display: inline-block;
            background: var(--success-light);
            color: var(--success);
            font-weight: 600;
        }

        .logout-btn {
            background: white;
            border: 2px solid var(--danger);
            border-radius: 12px;
            padding: 12px 25px;
            font-size: 15px;
            font-weight: 600;
            color: var(--danger);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logout-btn:hover {
            background: var(--danger-light);
        }

        /* Main Content */
        .admin-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
        }

        .card-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title i {
            color: var(--primary);
        }

        /* Global Settings */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .setting-label {
            font-size: 15px;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-label i {
            color: var(--primary);
        }

        .setting-input {
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            color: var(--dark);
            transition: border-color 0.3s;
            width: 100%;
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .setting-note {
            font-size: 13px;
            color: var(--gray);
        }

        .save-settings-btn {
            background: var(--success);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            justify-content: center;
        }

        .save-settings-btn:hover:not(:disabled) {
            background: #2e7d32;
            transform: translateY(-2px);
        }

        .save-settings-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }

        .data-table thead {
            background: var(--light);
        }

        .data-table th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--border);
            white-space: nowrap;
        }

        .data-table td {
            padding: 16px 15px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .data-table tbody tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        /* Status Badges */
        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            text-align: center;
            min-width: 90px;
        }

        .status-pending {
            background: var(--warning-light);
            color: var(--warning);
        }

        .status-approved {
            background: var(--success-light);
            color: var(--success);
        }

        .status-rejected {
            background: var(--danger-light);
            color: var(--danger);
        }

        .status-refunded {
            background: var(--info-light);
            color: var(--info);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .view-btn {
            background: var(--info-light);
            color: var(--info);
        }

        .view-btn:hover {
            background: var(--info);
            color: white;
        }

        .approve-btn {
            background: var(--success-light);
            color: var(--success);
        }

        .approve-btn:hover {
            background: var(--success);
            color: white;
        }

        .reject-btn {
            background: var(--danger-light);
            color: var(--danger);
        }

        .reject-btn:hover {
            background: var(--danger);
            color: white;
        }

        .remove-btn {
            background: var(--warning-light);
            color: var(--warning);
        }

        .remove-btn:hover {
            background: var(--warning);
            color: white;
        }

        .refund-btn {
            background: var(--info-light);
            color: var(--info);
        }

        .refund-btn:hover {
            background: var(--info);
            color: white;
        }

        .stop-btn {
            background: var(--warning-light);
            color: var(--warning);
        }

        .stop-btn:hover {
            background: var(--warning);
            color: white;
        }

        .ban-btn {
            background: var(--danger-light);
            color: var(--danger);
        }

        .ban-btn:hover {
            background: var(--danger);
            color: white;
        }

        .unban-btn {
            background: var(--success-light);
            color: var(--success);
        }

        .unban-btn:hover {
            background: var(--success);
            color: white;
        }

        .copy-btn {
            background: var(--light);
            color: var(--gray);
            border: 1px solid var(--border);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* User Badge */
        .user-badge {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar-small {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
            overflow: hidden;
        }

        .user-avatar-small img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info-small {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }

        .user-email {
            font-size: 12px;
            color: var(--gray);
        }

        /* Search and Filter */
        .filter-bar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 14px 20px 14px 50px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            color: var(--dark);
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .filter-select {
            padding: 14px 20px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            color: var(--dark);
            background: white;
            cursor: pointer;
            min-width: 180px;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            gap: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-icon.users { background: rgba(102, 126, 234, 0.1); color: var(--primary); }
        .stat-icon.sellers { background: rgba(56, 142, 60, 0.1); color: var(--success); }
        .stat-icon.pending { background: rgba(245, 124, 0, 0.1); color: var(--warning); }
        .stat-icon.revenue { background: rgba(118, 75, 162, 0.1); color: var(--secondary); }
        .stat-icon.withdraw { background: rgba(25, 118, 210, 0.1); color: var(--info); }
        .stat-icon.earnings { background: rgba(211, 47, 47, 0.1); color: var(--danger); }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray);
            font-weight: 500;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 25px 30px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            background: var(--light);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: var(--border);
        }

        .modal-body {
            padding: 30px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .detail-grid {
                grid-template-columns: 1fr;
            }
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .detail-label {
            font-size: 13px;
            color: var(--gray);
            font-weight: 600;
        }

        .detail-value {
            font-size: 15px;
            color: var(--dark);
            font-weight: 500;
            word-break: break-all;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid var(--border);
        }

        /* Notification Modal */
        .notification-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-select, .form-input, .form-textarea {
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 15px;
            color: var(--dark);
            background: white;
            transition: border-color 0.3s;
        }

        .form-select:focus, .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Edit Balance Modal */
        .balance-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }

        .balance-input {
            flex: 1;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
        }

        .balance-btn {
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .balance-add {
            background: var(--success-light);
            color: var(--success);
        }

        .balance-add:hover {
            background: var(--success);
            color: white;
        }

        .balance-subtract {
            background: var(--danger-light);
            color: var(--danger);
        }

        .balance-subtract:hover {
            background: var(--danger);
            color: white;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 60px;
            color: #bdc3c7;
            margin-bottom: 20px;
        }

        .empty-text {
            color: var(--gray);
            font-size: 16px;
        }

        /* Messages */
        .message {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .message.success {
            background: var(--success-light);
            color: var(--success);
            display: block;
        }

        .message.error {
            background: var(--danger-light);
            color: var(--danger);
            display: block;
        }

        .message.info {
            background: var(--info-light);
            color: var(--info);
            display: block;
        }

        .message.warning {
            background: var(--warning-light);
            color: var(--warning);
            display: block;
        }

        /* Loader */
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            vertical-align: middle;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            background: var(--light);
            border-radius: 12px;
            padding: 6px;
            margin-bottom: 25px;
        }

        .tab-btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            color: var(--gray);
            background: transparent;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.7);
        }

        .tab-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* Mobile Responsive */
        @media (max-width: 1200px) {
            .admin-container {
                padding: 15px;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
            
            .header-left, .header-right {
                width: 100%;
            }
            
            .admin-profile {
                justify-content: center;
            }
            
            .admin-info {
                text-align: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-bar {
                flex-direction: column;
            }
            
            .search-box, .filter-select {
                min-width: 100%;
            }
            
            .card {
                padding: 20px;
            }
            
            .data-table {
                min-width: 1000px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
            }
            
            .modal-actions {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: 30px 20px;
            }
            
            .login-title {
                font-size: 26px;
            }
            
            .card-title {
                font-size: 20px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                padding: 12px;
            }
            
            .modal-header, .modal-body {
                padding: 20px;
            }
        }

        /* Ensure scrollable on all screens */
        .scrollable-container {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
    </style>
</head>
<body class="scrollable-container">
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <div class="login-icon">
                <i class="fas fa-user-shield"></i>
            </div>
            <h1 class="login-title">Admin Panel</h1>
            <p class="login-subtitle">Data Seller App Administration - Manage users, payments, and settings</p>
            <div id="loginMessage" class="message"></div>
            <button id="googleLoginBtn" class="login-btn">
                <i class="fab fa-google"></i>
                Sign in with Google
            </button>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="admin-container" style="display: none;">
        <!-- Header -->
        <div class="admin-header">
            <div class="header-left">
                <h1>Data Seller Admin Panel</h1>
                <p>Manage users, payments, and app settings in real-time</p>
            </div>
            <div class="header-right">
                <div class="admin-profile">
                    <div class="admin-avatar" id="adminAvatar">
                        <img id="adminAvatarImg" style="display: none;">
                        <span id="adminAvatarText">A</span>
                    </div>
                    <div class="admin-info">
                        <div class="admin-email" id="adminEmail">admin@example.com</div>
                        <div class="admin-role">Administrator</div>
                    </div>
                </div>
                <button id="sendNotificationBtn" class="logout-btn" style="background: var(--info-light); color: var(--info); border-color: var(--info);">
                    <i class="fas fa-bell"></i>
                    Send Notification
                </button>
                <button id="logoutBtn" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </div>

        <!-- Messages -->
        <div id="adminMessage" class="message"></div>

        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card" onclick="switchTab('sellerRequests')">
                <div class="stat-icon users">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">Total Users</div>
                </div>
            </div>
            
            <div class="stat-card" onclick="switchTab('sellerRequests')">
                <div class="stat-icon sellers">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="totalSellers">0</div>
                    <div class="stat-label">Active Sellers</div>
                </div>
            </div>
            
            <div class="stat-card" onclick="switchTab('sellerRequests')">
                <div class="stat-icon pending">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="pendingSellerRequests">0</div>
                    <div class="stat-label">Pending Seller Reqs</div>
                </div>
            </div>
            
            <div class="stat-card" onclick="switchTab('withdrawRequests')">
                <div class="stat-icon withdraw">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="pendingWithdrawals">0</div>
                    <div class="stat-label">Pending Withdrawals</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon revenue">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="totalRevenue">₹0</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon earnings">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="totalPaidOut">₹0</div>
                    <div class="stat-label">Total Paid Out</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="admin-content">
            <!-- Global Settings Card -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-cog"></i>
                        Global Settings
                    </h2>
                </div>
                
                <div class="settings-grid">
                    <div class="setting-item">
                        <label class="setting-label">
                            <i class="fas fa-tag"></i>
                            Seller Price (₹)
                        </label>
                        <input type="number" id="sellerPriceInput" class="setting-input" placeholder="599">
                        <div class="setting-note">Price users pay to become a seller</div>
                    </div>
                    
                    <div class="setting-item">
                        <label class="setting-label">
                            <i class="fas fa-chart-bar"></i>
                            Earning per 10MB (₹)
                        </label>
                        <input type="number" id="earningPer10MBInput" class="setting-input" placeholder="2" step="0.1">
                        <div class="setting-note">Earning amount for every 10MB data used</div>
                    </div>
                    
                    <div class="setting-item">
                        <label class="setting-label">
                            <i class="fas fa-tachometer-alt"></i>
                            Daily Limit (₹)
                        </label>
                        <input type="number" id="dailyLimitInput" class="setting-input" placeholder="1000">
                        <div class="setting-note">Maximum daily earning limit per user</div>
                    </div>
                    
                    <div class="setting-item">
                        <label class="setting-label">
                            <i class="fas fa-money-bill-wave"></i>
                            Minimum Withdraw (₹)
                        </label>
                        <input type="number" id="minWithdrawInput" class="setting-input" placeholder="100">
                        <div class="setting-note">Minimum balance required for withdrawal</div>
                    </div>
                    
                    <div class="setting-item">
                        <label class="setting-label">
                            <i class="fas fa-qrcode"></i>
                            UPI ID
                        </label>
                        <input type="text" id="upiIdInput" class="setting-input" placeholder="yourname@upi">
                        <div class="setting-note">UPI ID for seller payments</div>
                    </div>
                    
                    <div class="setting-item">
                        <label class="setting-label">
                            <i class="fas fa-image"></i>
                            QR Code URL
                        </label>
                        <input type="text" id="qrCodeUrlInput" class="setting-input" placeholder="https://example.com/qr.png">
                        <div class="setting-note">URL to payment QR code image</div>
                    </div>
                </div>
                
                <button id="saveSettingsBtn" class="save-settings-btn">
                    <i class="fas fa-save"></i>
                    Save Global Settings
                </button>
            </div>

            <!-- Tabs for Management -->
            <div class="card">
                <div class="tabs">
                    <button class="tab-btn active" data-tab="sellerRequests">
                        <i class="fas fa-user-tie"></i>
                        Seller Requests
                    </button>
                    <button class="tab-btn" data-tab="withdrawRequests">
                        <i class="fas fa-money-bill-wave"></i>
                        Withdraw Requests
                    </button>
                    <button class="tab-btn" data-tab="userManagement">
                        <i class="fas fa-users-cog"></i>
                        User Management
                    </button>
                </div>

                <!-- Seller Requests Tab -->
                <div id="sellerRequestsTab" class="tab-content">
                    <div class="filter-bar">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="sellerSearch" class="search-input" placeholder="Search by name, email, or UPI ID...">
                        </div>
                        <select id="sellerStatusFilter" class="filter-select">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>UPI ID</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="sellerRequestsTable">
                                <!-- Seller requests will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Withdraw Requests Tab -->
                <div id="withdrawRequestsTab" class="tab-content" style="display: none;">
                    <div class="filter-bar">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="withdrawSearch" class="search-input" placeholder="Search by name, email, or UPI ID...">
                        </div>
                        <select id="withdrawStatusFilter" class="filter-select">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                            <option value="refunded">Refunded</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>UPI ID</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="withdrawRequestsTable">
                                <!-- Withdraw requests will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- User Management Tab -->
                <div id="userManagementTab" class="tab-content" style="display: none;">
                    <div class="filter-bar">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="userSearch" class="search-input" placeholder="Search by name or email...">
                        </div>
                        <select id="userRoleFilter" class="filter-select">
                            <option value="all">All Users</option>
                            <option value="seller">Sellers Only</option>
                            <option value="free">Free Users Only</option>
                        </select>
                        <select id="userStatusFilter" class="filter-select">
                            <option value="all">All Status</option>
                            <option value="earning">Earning Now</option>
                            <option value="banned">Banned</option>
                            <option value="active">Active</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Status</th>
                                    <th>Balance</th>
                                    <th>Today Earning</th>
                                    <th>Total Earnings</th>
                                    <th>Earning Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Request Details -->
    <div id="requestModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-file-alt"></i>
                    <span id="modalTitle">Request Details</span>
                </h3>
                <button class="modal-close" id="modalCloseBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="detail-grid" id="modalDetails">
                    <!-- Details will be loaded here -->
                </div>
                <div class="modal-actions" id="modalActions">
                    <!-- Action buttons will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Send Notification -->
    <div id="notificationModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-bell"></i>
                    Send Notification
                </h3>
                <button class="modal-close" id="notificationModalCloseBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="notification-form">
                    <div class="form-group">
                        <label class="form-label">Send To</label>
                        <select id="notificationTarget" class="form-select">
                            <option value="ALL">All Users</option>
                            <option value="specific">Specific User</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="specificUserGroup" style="display: none;">
                        <label class="form-label">User UID</label>
                        <input type="text" id="notificationUid" class="form-input" placeholder="Enter user UID">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Notification Title</label>
                        <input type="text" id="notificationTitle" class="form-input" placeholder="Enter title" maxlength="100">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Notification Message</label>
                        <textarea id="notificationMessage" class="form-textarea" placeholder="Enter your message" maxlength="500"></textarea>
                    </div>
                    
                    <button id="sendNotificationSubmitBtn" class="save-settings-btn" style="margin-top: 20px;">
                        <i class="fas fa-paper-plane"></i>
                        Send Notification
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Edit Balance -->
    <div id="editBalanceModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-wallet"></i>
                    Edit User Balance
                </h3>
                <button class="modal-close" id="editBalanceModalCloseBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="detail-grid" id="editBalanceDetails">
                    <!-- User details will be loaded here -->
                </div>
                
                <div class="form-group">
                    <label class="form-label">Current Balance: <span id="currentBalanceDisplay">₹0</span></label>
                    <div class="balance-controls">
                        <input type="number" id="balanceAmountInput" class="balance-input" placeholder="Enter amount" min="1" step="1">
                        <button class="balance-btn balance-add" onclick="window.addBalance()">
                            <i class="fas fa-plus"></i> Add
                        </button>
                        <button class="balance-btn balance-subtract" onclick="window.subtractBalance()">
                            <i class="fas fa-minus"></i> Subtract
                        </button>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="action-btn" onclick="window.closeEditBalanceModal()" style="flex: 1; background: var(--light); color: var(--gray);">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="action-btn approve-btn" onclick="window.saveBalanceChanges()" style="flex: 1;">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { 
            getAuth, 
            GoogleAuthProvider, 
            signInWithPopup, 
            signOut, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            doc, 
            getDoc, 
            setDoc, 
            updateDoc, 
            addDoc, 
            query, 
            where, 
            orderBy,
            serverTimestamp,
            onSnapshot,
            increment
        } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB-BwjDUorqfsC9z04-V63ETvoEmKsazvM",
            authDomain: "datasellerapp.firebaseapp.com",
            projectId: "datasellerapp",
            storageBucket: "datasellerapp.firebasestorage.app",
            messagingSenderId: "218329701404",
            appId: "1:218329701404:web:d908e86db9a946d4d2d3d9"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const adminDashboard = document.getElementById('adminDashboard');
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const sendNotificationBtn = document.getElementById('sendNotificationBtn');
        const loginMessage = document.getElementById('loginMessage');
        const adminMessage = document.getElementById('adminMessage');
        
        // Admin Info
        const adminEmail = document.getElementById('adminEmail');
        const adminAvatar = document.getElementById('adminAvatar');
        const adminAvatarImg = document.getElementById('adminAvatarImg');
        const adminAvatarText = document.getElementById('adminAvatarText');
        
        // Global Settings
        const sellerPriceInput = document.getElementById('sellerPriceInput');
        const earningPer10MBInput = document.getElementById('earningPer10MBInput');
        const dailyLimitInput = document.getElementById('dailyLimitInput');
        const minWithdrawInput = document.getElementById('minWithdrawInput');
        const upiIdInput = document.getElementById('upiIdInput');
        const qrCodeUrlInput = document.getElementById('qrCodeUrlInput');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        
        // Stats
        const totalUsers = document.getElementById('totalUsers');
        const totalSellers = document.getElementById('totalSellers');
        const pendingSellerRequests = document.getElementById('pendingSellerRequests');
        const pendingWithdrawals = document.getElementById('pendingWithdrawals');
        const totalRevenue = document.getElementById('totalRevenue');
        const totalPaidOut = document.getElementById('totalPaidOut');
        
        // Tabs
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = {
            sellerRequests: document.getElementById('sellerRequestsTab'),
            withdrawRequests: document.getElementById('withdrawRequestsTab'),
            userManagement: document.getElementById('userManagementTab')
        };
        
        // Search and Filter
        const sellerSearch = document.getElementById('sellerSearch');
        const sellerStatusFilter = document.getElementById('sellerStatusFilter');
        const withdrawSearch = document.getElementById('withdrawSearch');
        const withdrawStatusFilter = document.getElementById('withdrawStatusFilter');
        const userSearch = document.getElementById('userSearch');
        const userRoleFilter = document.getElementById('userRoleFilter');
        const userStatusFilter = document.getElementById('userStatusFilter');
        
        // Tables
        const sellerRequestsTable = document.getElementById('sellerRequestsTable');
        const withdrawRequestsTable = document.getElementById('withdrawRequestsTable');
        const usersTable = document.getElementById('usersTable');
        
        // Modals
        const requestModal = document.getElementById('requestModal');
        const notificationModal = document.getElementById('notificationModal');
        const editBalanceModal = document.getElementById('editBalanceModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalDetails = document.getElementById('modalDetails');
        const modalActions = document.getElementById('modalActions');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const notificationModalCloseBtn = document.getElementById('notificationModalCloseBtn');
        const editBalanceModalCloseBtn = document.getElementById('editBalanceModalCloseBtn');
        
        // Notification Modal Elements
        const notificationTarget = document.getElementById('notificationTarget');
        const specificUserGroup = document.getElementById('specificUserGroup');
        const notificationUid = document.getElementById('notificationUid');
        const notificationTitle = document.getElementById('notificationTitle');
        const notificationMessage = document.getElementById('notificationMessage');
        const sendNotificationSubmitBtn = document.getElementById('sendNotificationSubmitBtn');
        
        // Edit Balance Modal Elements
        const editBalanceDetails = document.getElementById('editBalanceDetails');
        const currentBalanceDisplay = document.getElementById('currentBalanceDisplay');
        const balanceAmountInput = document.getElementById('balanceAmountInput');
        
        // State
        let currentAdmin = null;
        let appSettings = {
            sellerPrice: 599,
            earningPer10MB: 2,
            dailyLimit: 1000,
            minWithdraw: 100,
            upiId: '',
            qrCodeUrl: ''
        };
        
        let unsubscribeCallbacks = {
            sellerRequests: null,
            withdrawRequests: null,
            users: null,
            settings: null
        };

        let allSellerRequests = [];
        let allWithdrawRequests = [];
        let allUsers = [];
        
        let currentModalData = null;
        let currentModalType = null;
        let currentEditUser = null;

        // Format Currency
        function formatCurrency(amount) {
            if (!amount && amount !== 0) return '₹0';
            return `₹${parseInt(amount) || 0}`;
        }

        // Format Date
        function formatDate(timestamp) {
            if (!timestamp) return 'N/A';
            try {
                const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
                return date.toLocaleDateString('en-IN', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                console.error('Error formatting date:', e);
                return 'N/A';
            }
        }

        // Show Message
        function showMessage(element, text, type) {
            if (element) {
                element.textContent = text;
                element.className = 'message ' + type;
                
                setTimeout(() => {
                    element.className = 'message';
                    element.textContent = '';
                }, 5000);
            }
        }

        // Copy to Clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text)
                .then(() => {
                    showMessage(adminMessage, 'Copied to clipboard!', 'success');
                })
                .catch(err => {
                    showMessage(adminMessage, 'Failed to copy', 'error');
                });
        }

        // Show Loading State
        function showLoading(element, colSpan = 6) {
            if (element) {
                element.innerHTML = `
                    <tr>
                        <td colspan="${colSpan}" style="text-align: center; padding: 40px;">
                            <div class="loader"></div>
                            <div style="margin-top: 10px; color: var(--gray);">Loading...</div>
                        </td>
                    </tr>
                `;
            }
        }

        // Show Empty State
        function showEmptyState(element, colSpan = 6, message = 'No data found') {
            if (element) {
                element.innerHTML = `
                    <tr>
                        <td colspan="${colSpan}" class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-inbox"></i>
                            </div>
                            <div class="empty-text">${message}</div>
                        </td>
                    </tr>
                `;
            }
        }

        // Send Notification
        async function sendNotification(uid, title, message) {
            try {
                await addDoc(collection(db, 'notifications'), {
                    uid: uid,
                    title: title,
                    message: message,
                    createdAt: serverTimestamp(),
                    read: false
                });
                
                showMessage(adminMessage, `Notification sent to ${uid === 'ALL' ? 'all users' : 'user'}`, 'success');
                
            } catch (error) {
                console.error('Error sending notification:', error);
                showMessage(adminMessage, `Error sending notification: ${error.message}`, 'error');
            }
        }

        // Load Global Settings
        function loadGlobalSettings() {
            const settingsRef = doc(db, 'appSettings', 'main');
            
            unsubscribeCallbacks.settings = onSnapshot(settingsRef, (docSnap) => {
                if (docSnap.exists()) {
                    appSettings = docSnap.data();
                    
                    // Update UI
                    sellerPriceInput.value = appSettings.sellerPrice || 599;
                    earningPer10MBInput.value = appSettings.earningPer10MB || 2;
                    dailyLimitInput.value = appSettings.dailyLimit || 1000;
                    minWithdrawInput.value = appSettings.minWithdraw || 100;
                    upiIdInput.value = appSettings.upiId || '';
                    qrCodeUrlInput.value = appSettings.qrCodeUrl || '';
                } else {
                    // Create default settings
                    setDoc(settingsRef, appSettings)
                        .then(() => console.log('Default settings created'))
                        .catch(err => console.error('Error creating settings:', err));
                }
            });
        }

        // Save Global Settings
        async function saveGlobalSettings() {
            const sellerPrice = parseFloat(sellerPriceInput.value);
            const earningPer10MB = parseFloat(earningPer10MBInput.value);
            const dailyLimit = parseFloat(dailyLimitInput.value);
            const minWithdraw = parseFloat(minWithdrawInput.value);
            const upiId = upiIdInput.value.trim();
            const qrCodeUrl = qrCodeUrlInput.value.trim();
            
            if (!sellerPrice || sellerPrice <= 0) {
                showMessage(adminMessage, 'Please enter a valid seller price', 'error');
                return;
            }
            
            if (!earningPer10MB || earningPer10MB <= 0) {
                showMessage(adminMessage, 'Please enter a valid earning amount', 'error');
                return;
            }
            
            if (!dailyLimit || dailyLimit <= 0) {
                showMessage(adminMessage, 'Please enter a valid daily limit', 'error');
                return;
            }
            
            if (!minWithdraw || minWithdraw <= 0) {
                showMessage(adminMessage, 'Please enter a valid minimum withdraw amount', 'error');
                return;
            }
            
            try {
                saveSettingsBtn.innerHTML = '<span class="loader"></span>Saving...';
                saveSettingsBtn.disabled = true;
                
                const settingsRef = doc(db, 'appSettings', 'main');
                await updateDoc(settingsRef, {
                    sellerPrice: sellerPrice,
                    earningPer10MB: earningPer10MB,
                    dailyLimit: dailyLimit,
                    minWithdraw: minWithdraw,
                    upiId: upiId,
                    qrCodeUrl: qrCodeUrl,
                    updatedAt: serverTimestamp(),
                    updatedBy: currentAdmin.email
                });
                
                showMessage(adminMessage, 'Global settings saved successfully!', 'success');
                
                saveSettingsBtn.innerHTML = '<i class="fas fa-save"></i> Save Global Settings';
                saveSettingsBtn.disabled = false;
                
            } catch (error) {
                console.error('Error saving settings:', error);
                showMessage(adminMessage, `Error: ${error.message}`, 'error');
                
                saveSettingsBtn.innerHTML = '<i class="fas fa-save"></i> Save Global Settings';
                saveSettingsBtn.disabled = false;
            }
        }

        // Load Seller Requests
        function loadSellerRequests() {
            showLoading(sellerRequestsTable);
            
            const sellerRequestsQuery = query(
                collection(db, 'sellerRequests'),
                orderBy('createdAt', 'desc')
            );
            
            unsubscribeCallbacks.sellerRequests = onSnapshot(sellerRequestsQuery, (querySnapshot) => {
                allSellerRequests = [];
                sellerRequestsTable.innerHTML = '';
                
                if (querySnapshot.empty) {
                    showEmptyState(sellerRequestsTable, 6, 'No seller requests found');
                    updateStats();
                    return;
                }
                
                querySnapshot.forEach((docSnap) => {
                    const request = docSnap.data();
                    request.id = docSnap.id;
                    allSellerRequests.push(request);
                });
                
                updateSellerRequestsTable(allSellerRequests);
                updateStats();
            }, (error) => {
                console.error('Error loading seller requests:', error);
                showMessage(adminMessage, 'Error loading seller requests', 'error');
            });
        }

        // Update Seller Requests Table
        function updateSellerRequestsTable(requests) {
            sellerRequestsTable.innerHTML = '';
            
            if (requests.length === 0) {
                showEmptyState(sellerRequestsTable, 6, 'No matching requests found');
                return;
            }
            
            requests.forEach((request) => {
                const status = request.status || 'pending';
                const statusClass = `status-${status}`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="user-badge">
                            <div class="user-avatar-small">
                                ${request.name ? request.name.charAt(0).toUpperCase() : 'U'}
                            </div>
                            <div class="user-info-small">
                                <div class="user-name">${request.name || 'No name'}</div>
                                <div class="user-email">${request.email || 'No email'}</div>
                                <div style="font-size: 11px; color: var(--gray); margin-top: 2px;">
                                    UID: ${request.uid || 'N/A'}
                                    <button class="copy-btn" onclick="event.stopPropagation(); window.copyText('${request.uid}')" style="margin-left: 5px;">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div style="font-family: monospace; font-size: 14px;">${request.entered_upi || 'N/A'}</div>
                        ${request.entered_upi ? `<button class="copy-btn" onclick="event.stopPropagation(); window.copyText('${request.entered_upi}')" style="margin-top: 5px;">
                            <i class="fas fa-copy"></i> Copy
                        </button>` : ''}
                    </td>
                    <td style="font-weight: 600; font-size: 16px;">${formatCurrency(request.amount)}</td>
                    <td><span class="status-badge ${statusClass}">${status.toUpperCase()}</span></td>
                    <td style="white-space: nowrap; font-size: 13px;">${formatDate(request.createdAt)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view-btn" onclick="event.stopPropagation(); window.showRequestDetails('seller', '${request.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            ${status === 'pending' ? `
                                <button class="action-btn approve-btn" onclick="event.stopPropagation(); window.approveSellerRequest('${request.id}', '${request.uid}')">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="action-btn reject-btn" onclick="event.stopPropagation(); window.rejectSellerRequest('${request.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            ` : ''}
                        </div>
                    </td>
                `;
                sellerRequestsTable.appendChild(row);
            });
        }

        // Show Request Details Modal
        function showRequestDetails(type, requestId) {
            let request;
            if (type === 'seller') {
                request = allSellerRequests.find(req => req.id === requestId);
            } else {
                request = allWithdrawRequests.find(req => req.id === requestId);
            }
            
            if (!request) return;
            
            currentModalData = request;
            currentModalType = type;
            
            if (type === 'seller') {
                modalTitle.textContent = 'Seller Request Details';
                
                modalDetails.innerHTML = `
                    <div class="detail-item">
                        <div class="detail-label">User Name</div>
                        <div class="detail-value">${request.name || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Email</div>
                        <div class="detail-value">${request.email || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">User ID</div>
                        <div class="detail-value" style="word-break: break-all;">
                            ${request.uid || 'N/A'}
                            <button class="copy-btn" onclick="window.copyText('${request.uid}')" style="margin-left: 5px;">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">UPI ID</div>
                        <div class="detail-value" style="font-family: monospace;">
                            ${request.entered_upi || 'N/A'}
                            ${request.entered_upi ? `<button class="copy-btn" onclick="window.copyText('${request.entered_upi}')" style="margin-left: 5px;">
                                <i class="fas fa-copy"></i>
                            </button>` : ''}
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Amount</div>
                        <div class="detail-value" style="font-weight: 600;">${formatCurrency(request.amount)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Status</div>
                        <div class="detail-value">
                            <span class="status-badge status-${request.status || 'pending'}">${(request.status || 'pending').toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Created At</div>
                        <div class="detail-value">${formatDate(request.createdAt)}</div>
                    </div>
                    ${request.approvedAt ? `
                    <div class="detail-item">
                        <div class="detail-label">Approved At</div>
                        <div class="detail-value">${formatDate(request.approvedAt)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Approved By</div>
                        <div class="detail-value">${request.approvedBy || 'N/A'}</div>
                    </div>
                    ` : ''}
                    ${request.rejectedAt ? `
                    <div class="detail-item">
                        <div class="detail-label">Rejected At</div>
                        <div class="detail-value">${formatDate(request.rejectedAt)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Rejected By</div>
                        <div class="detail-value">${request.rejectedBy || 'N/A'}</div>
                    </div>
                    ` : ''}
                `;
                
                modalActions.innerHTML = '';
                if (request.status === 'pending') {
                    modalActions.innerHTML = `
                        <button class="action-btn approve-btn" style="flex: 1;" onclick="window.approveSellerRequest('${request.id}', '${request.uid}')">
                            <i class="fas fa-check"></i> Approve Request
                        </button>
                        <button class="action-btn reject-btn" style="flex: 1;" onclick="window.rejectSellerRequest('${request.id}')">
                            <i class="fas fa-times"></i> Reject Request
                        </button>
                        <button class="action-btn remove-btn" style="flex: 1;" onclick="window.removeSellerPlan('${request.uid}')">
                            <i class="fas fa-user-minus"></i> Remove Plan
                        </button>
                    `;
                } else if (request.status === 'approved') {
                    modalActions.innerHTML = `
                        <button class="action-btn remove-btn" style="flex: 1;" onclick="window.removeSellerPlan('${request.uid}')">
                            <i class="fas fa-user-minus"></i> Remove Plan
                        </button>
                    `;
                }
            } else {
                modalTitle.textContent = 'Withdrawal Request Details';
                
                modalDetails.innerHTML = `
                    <div class="detail-item">
                        <div class="detail-label">User Name</div>
                        <div class="detail-value">${request.name || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Email</div>
                        <div class="detail-value">${request.email || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">UPI ID</div>
                        <div class="detail-value" style="font-family: monospace;">
                            ${request.upi || 'N/A'}
                            ${request.upi ? `<button class="copy-btn" onclick="window.copyText('${request.upi}')" style="margin-left: 5px;">
                                <i class="fas fa-copy"></i>
                            </button>` : ''}
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Amount</div>
                        <div class="detail-value" style="font-weight: 600;">${formatCurrency(request.amount)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Status</div>
                        <div class="detail-value">
                            <span class="status-badge status-${request.status || 'pending'}">${(request.status || 'pending').toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Created At</div>
                        <div class="detail-value">${formatDate(request.createdAt)}</div>
                    </div>
                `;
                
                modalActions.innerHTML = '';
                if (request.status === 'pending') {
                    modalActions.innerHTML = `
                        <button class="action-btn approve-btn" style="flex: 1;" onclick="window.approveWithdrawRequest('${request.id}', '${request.uid}', ${request.amount})">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="action-btn reject-btn" style="flex: 1;" onclick="window.rejectWithdrawRequest('${request.id}')">
                            <i class="fas fa-times"></i> Reject
                        </button>
                        <button class="action-btn refund-btn" style="flex: 1;" onclick="window.refundWithdrawRequest('${request.id}')">
                            <i class="fas fa-undo"></i> Refund
                        </button>
                    `;
                }
            }
            
            requestModal.classList.add('active');
        }

        // Approve Seller Request
        async function approveSellerRequest(requestId, userId) {
            if (!confirm('Approve this seller request? This will upgrade the user to seller status.')) {
                return;
            }
            
            try {
                // Update seller request status
                const requestRef = doc(db, 'sellerRequests', requestId);
                await updateDoc(requestRef, {
                    status: 'approved',
                    approvedAt: serverTimestamp(),
                    approvedBy: currentAdmin.email
                });
                
                // Update user document
                const userRef = doc(db, 'users', userId);
                await updateDoc(userRef, {
                    role: 'seller',
                    planActive: true,
                    isEarning: false,
                    updatedAt: serverTimestamp()
                });
                
                // Send notification to user
                await sendNotification(userId, 'Seller Plan Approved', 'Your seller plan has been approved! You can now start earning.');
                
                showMessage(adminMessage, 'Seller request approved! User upgraded to seller.', 'success');
                closeModal();
                
            } catch (error) {
                console.error('Error approving seller request:', error);
                showMessage(adminMessage, `Error: ${error.message}`, 'error');
            }
        }

        // Reject Seller Request
        async function rejectSellerRequest(requestId) {
            if (!confirm('Reject this seller request?')) {
                return;
            }
            
            try {
                const request = allSellerRequests.find(req => req.id === requestId);
                if (!request) return;
                
                const requestRef = doc(db, 'sellerRequests', requestId);
                await updateDoc(requestRef, {
                    status: 'rejected',
                    rejectedAt: serverTimestamp(),
                    rejectedBy: currentAdmin.email
                });
                
                // Send notification to user
                await sendNotification(request.uid, 'Seller Plan Rejected', 'Your seller plan request has been rejected.');
                
                showMessage(adminMessage, 'Seller request rejected', 'info');
                closeModal();
                
            } catch (error) {
                console.error('Error rejecting seller request:', error);
                showMessage(adminMessage, `Error: ${error.message}`, 'error');
            }
        }

        // Remove Seller Plan
        async function removeSellerPlan(userId) {
            if (!confirm('Remove seller plan from this user? This will downgrade them to free user and stop their earnings.')) {
                return;
            }
            
            try {
                const userRef = doc(db, 'users', userId);
                await updateDoc(userRef, {
                    role: 'free',
                    planActive: false,
                    isEarning: false,
                    updatedAt: serverTimestamp()
                });
                
                // Send notification to user
                await sendNotification(userId, 'Seller Plan Removed', 'Your seller plan has been removed by admin.');
                
                showMessage(adminMessage, 'Seller plan removed successfully', 'success');
                closeModal();
                
            } catch (error) {
                console.error('Error removing seller plan:', error);
                showMessage(adminMessage, `Error: ${error.message}`, 'error');
            }
        }

        // Load Withdraw Requests
        function loadWithdrawRequests() {
            showLoading(withdrawRequestsTable);
            
            const withdrawRequestsQuery = query(
                collection(db, 'withdrawRequests'),
                orderBy('createdAt', 'desc')
            );
            
            unsubscribeCallbacks.withdrawRequests = onSnapshot(withdrawRequestsQuery, (querySnapshot) => {
                allWithdrawRequests = [];
                withdrawRequestsTable.innerHTML = '';
                
                if (querySnapshot.empty) {
                    showEmptyState(withdrawRequestsTable, 6, 'No withdraw requests found');
                    updateStats();
                    return;
                }
                
                querySnapshot.forEach((docSnap) => {
                    const request = docSnap.data();
                    request.id = docSnap.id;
                    allWithdrawRequests.push(request);
                });
                
                updateWithdrawRequestsTable(allWithdrawRequests);
                updateStats();
            }, (error) => {
                console.error('Error loading withdraw requests:', error);
                showMessage(adminMessage, 'Error loading withdraw requests', 'error');
            });
        }

        // Update Withdraw Requests Table
        function updateWithdrawRequestsTable(requests) {
            withdrawRequestsTable.innerHTML = '';
            
            if (requests.length === 0) {
                showEmptyState(withdrawRequestsTable, 6, 'No matching requests found');
                return;
            }
            
            requests.forEach((request) => {
                const status = request.status || 'pending';
                const statusClass = `status-${status}`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="user-badge">
                            <div class="user-avatar-small">
                                ${request.name ? request.name.charAt(0).toUpperCase() : 'U'}
                            </div>
                            <div class="user-info-small">
                                <div class="user-name">${request.name || 'No name'}</div>
                                <div class="user-email">${request.email || 'No email'}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div style="font-family: monospace; font-size: 14px;">${request.upi || 'N/A'}</div>
                        ${request.upi ? `<button class="copy-btn" onclick="event.stopPropagation(); window.copyText('${request.upi}')" style="margin-top: 5px;">
                            <i class="fas fa-copy"></i> Copy
                        </button>` : ''}
                    </td>
                    <td style="font-weight: 600; font-size: 16px;">${formatCurrency(request.amount)}</td>
                    <td><span class="status-badge ${statusClass}">${status.toUpperCase()}</span></td>
                    <td style="white-space: nowrap; font-size: 13px;">${formatDate(request.createdAt)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view-btn" onclick="event.stopPropagation(); window.showRequestDetails('withdraw', '${request.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            ${status === 'pending' ? `
                                <button class="action-btn approve-btn" onclick="event.stopPropagation(); window.approveWithdrawRequest('${request.id}', '${request.uid}', ${request.amount})">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="action-btn reject-btn" onclick="event.stopPropagation(); window.rejectWithdrawRequest('${request.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                                <button class="action-btn refund-btn" onclick="event.stopPropagation(); window.refundWithdrawRequest('${request.id}')">
                                    <i class="fas fa-undo"></i> Refund
                                </button>
                            ` : ''}
                        </div>
                    </td>
                `;
                withdrawRequestsTable.appendChild(row);
            });
        }

        // Approve Withdraw Request
        async function approveWithdrawRequest(requestId, userId, amount) {
            if (!confirm(`Approve this withdrawal request of ${formatCurrency(amount)}? This will deduct the amount from user's balance.`)) {
                return;
            }
            
            try {
                // Update user balance
                const userRef = doc(db, 'users', userId);
                await updateDoc(userRef, {
                    balance: increment(-amount),
                    updatedAt: serverTimestamp()
                });
                
                // Update withdraw request status
                const requestRef = doc(db, 'withdrawRequests', requestId);
                await updateDoc(requestRef, {
                    status: 'approved',
                    approvedAt: serverTimestamp(),
                    approvedBy: currentAdmin.email
                });
                
                // Send notification to user
                await sendNotification(userId, 'Withdrawal Approved', `Your withdrawal request of ${formatCurrency(amount)} has been approved and processed.`);
                
                showMessage(adminMessage, 'Withdrawal request approved and balance deducted', 'success');
                closeModal();
                
            } catch (error) {
                console.error('Error approving withdraw request:', error);
                showMessage(adminMessage, `Error: ${error.message}`, 'error');
            }
        }

        // Reject Withdraw Request
        async function rejectWithdrawRequest(requestId) {
            if (!confirm('Reject this withdrawal request?')) {
                return;
            }
            
            try {
                const request = allWithdrawRequests.find(req => req.id === requestId);
                if (!request) return;
                
                const requestRef = doc(db, 'withdrawRequests', requestId);
                await updateDoc(requestRef, {
                    status: 'rejected',
                    rejectedAt: serverTimestamp(),
                    rejectedBy: currentAdmin.email
                });
                
                // Send notification to user
                await sendNotification(request.uid, 'Withdrawal Rejected', `Your withdrawal request of ${formatCurrency(request.amount)} has been rejected.`);
                
                showMessage(adminMessage, 'Withdrawal request rejected', 'info');
                closeModal();
                
            } catch (error) {
                console.error('Error rejecting withdraw request:', error);
                showMessage(adminMessage, `Error: ${error.message}`, 'error');
            }
        }

        // Refund Withdraw Request
        async function refundWithdrawRequest(requestId) {
            if (!confirm('Mark this withdrawal as refunded? Use this if payment was sent back to user.')) {
                return;
            }
            
            try {
                const requestRef = doc(db, 'withdrawRequests', requestId);
                await updateDoc(requestRef, {
                    status: 'refunded',
                    refundedAt: serverTimestamp(),
                    refundedBy: currentAdmin.email
                });
                
                showMessage(adminMessage, 'Withdrawal marked as refunded', 'info');
                closeModal();
                
            } catch (error) {
                console.error('Error refunding withdraw request:', error);
                showMessage(adminMessage, `Error: ${error.message}`, 'error');
            }
        }

        // Load Users
        function loadUsers() {
            showLoading(usersTable, 7);
            
            const usersQuery = query(
                collection(db, 'users'),
                orderBy('createdAt', 'desc')
            );
            
            unsubscribeCallbacks.users = onSnapshot(usersQuery, (querySnapshot) => {
                allUsers = [];
                usersTable.innerHTML = '';
                
                if (querySnapshot.empty) {
                    showEmptyState(usersTable, 7, 'No users found');
                    updateStats();
                    return;
                }
                
                querySnapshot.forEach((docSnap) => {
                    const user = docSnap.data();
                    user.id = docSnap.id;
                    allUsers.push(user);
                });
                
                updateUsersTable(allUsers);
                updateStats();
            }, (error) => {
                console.error('Error loading users:', error);
                showMessage(adminMessage, 'Error loading users', 'error');
            });
        }

        // Update Users Table
        function updateUsersTable(users) {
            usersTable.innerHTML = '';
            
            if (users.length === 0) {
                showEmptyState(usersTable, 7, 'No matching users found');
                return;
            }
            
            users.forEach((user) => {
                const isSeller = user.role === 'seller' || user.planActive === true;
                const isBanned = user.banned === true;
                const isEarning = user.isEarning === true;
                
                const statusText = isBanned ? 'Banned' : (isSeller ? 'Seller' : 'Free');
                const statusColor = isBanned ? 'danger' : (isSeller ? 'success' : 'gray');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="user-badge">
                            <div class="user-avatar-small">
                                ${user.photoURL ? `<img src="${user.photoURL}" alt="${user.name}">` : user.name ? user.name.charAt(0).toUpperCase() : 'U'}
                            </div>
                            <div class="user-info-small">
                                <div class="user-name">${user.name || 'No name'}</div>
                                <div class="user-email">${user.email || 'No email'}</div>
                                <div style="font-size: 11px; color: var(--gray); margin-top: 2px;">
                                    UID: ${user.id}
                                    <button class="copy-btn" onclick="event.stopPropagation(); window.copyText('${user.id}')" style="margin-left: 5px;">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="status-badge" style="background: ${isBanned ? 'var(--danger-light)' : (isSeller ? 'var(--success-light)' : '#f8f9fa')}; 
                              color: ${isBanned ? 'var(--danger)' : (isSeller ? 'var(--success)' : 'var(--gray)')}">
                            ${statusText}
                        </span>
                    </td>
                    <td style="font-weight: 600; font-size: 16px;">${formatCurrency(user.balance || 0)}</td>
                    <td style="font-weight: 600; color: var(--warning);">${formatCurrency(user.todayEarning || 0)}</td>
                    <td style="font-weight: 600; color: var(--success);">${formatCurrency(user.totalEarnings || 0)}</td>
                    <td>
                        ${isEarning ? 
                            `<span class="status-badge" style="background: var(--success-light); color: var(--success);">
                                <i class="fas fa-play-circle"></i> Earning
                            </span>` : 
                            `<span class="status-badge" style="background: var(--gray); color: white;">
                                Stopped
                            </span>`
                        }
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view-btn" onclick="event.stopPropagation(); window.editUserBalance('${user.id}')">
                                <i class="fas fa-wallet"></i> Edit Balance
                            </button>
                            
                            ${isEarning && !isBanned ? `
                                <button class="action-btn stop-btn" onclick="event.stopPropagation(); window.forceStopEarning('${user.id}')">
                                    <i class="fas fa-stop"></i> Stop
                                </button>
                            ` : !isBanned && isSeller ? `
                                <button class="action-btn approve-btn" onclick="event.stopPropagation(); window.forceStartEarning('${user.id}')">
                                    <i class="fas fa-play"></i> Start
                                </button>
                            ` : ''}
                            
                            ${!isBanned ? `
                                <button class="action-btn ban-btn" onclick="event.stopPropagation(); window.banUser('${user.id}')">
                                    <i class="fas fa-ban"></i> Ban
                                </button>
                            ` : `
                                <button class="action-btn unban-btn" onclick="event.stopPropagation(); window.unbanUser('${user.id}')">
                                    <i class="fas fa-check"></i> Unban
                                </button>
                            `}
                        </div>
                    </td>
                `;
                usersTable.appendChild(row);
            });
        }

        // Edit User Balance
        async function editUserBalance(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;
            
            currentEditUser = user;
            
            editBalanceDetails.innerHTML = `
                <div class="detail-item">
                    <div class="detail-label">User Name</div>
                    <div class="detail-value">${user.name || 'No name'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Email</div>
                    <div class="detail-value">${user.email || 'No email'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">User ID</div>
                    <div class="detail-value" style="word-break: break-all;">${user.id}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Status</div>
                    <div class="detail-value">
                        <span class="status-badge" style="background: ${user.banned ? 'var(--danger-light)' : (user.role === 'seller' ? 'var(--success-light)' : '#f8f9fa')}; 
                              color: ${user.banned ? 'var(--danger)' : (user.role === 'seller' ? 'var(--success)' : 'var(--gray)')}">
                            ${user.banned ? 'Banned' : (user.role === 'seller' ? 'Seller' : 'Free')}
                        </span>
                    </div>
                </div>
            `;
            
            currentBalanceDisplay.textContent = formatCurrency(user.balance || 0);
            balanceAmountInput.value = '';
            
            editBalanceModal.classList.add('active');
        }

        // Add Balance
        async function addBalance() {
            const amount = parseFloat(balanceAmountInput.value);
            if (!amount || amount <= 0) {
                showMessage(adminMessage, 'Please enter a valid amount', 'error');
                return;
            }
            
            if (!currentEditUser) return;
            
            try {
                const userRef = doc(db, 'users', currentEditUser.id);
                await updateDoc(userRef, {
                    balance: increment(amount),
                    updatedAt: serverTimestamp()
                });
                
                // Update local state
                currentEditUser.balance = (currentEditUser.balance || 0) + amount;
                currentBalanceDisplay.textContent = formatCurrency(currentEditUser.balance);
                
                // Send notification to user
                await sendNotification(currentEditUser.id, 'Balance Added', `Admin has added ${formatCurrency(amount)} to your balance.`);
                
                showMessage(adminMessage, `Added ${formatCurrency(amount)} to user balance`, 'success');
                balanceAmountInput.value = '';
                
            } catch (error) {
                console.error('Error adding balance:', error);
                showMessage(adminMessage, `Error: ${error.message}`, 'error');
            }
        }

        // Subtract Balance
        async function subtractBalance() {
            const amount = parseFloat(balanceAmountInput.value);
            if (!amount || amount <= 0) {
                showMessage(adminMessage, 'Please enter a valid amount', 'error');
                return;
            }
            
            if (!currentEditUser) return;
            
            const currentBalance = currentEditUser.balance || 0;
            if (amount > currentBalance) {
                showMessage(adminMessage, `Cannot subtract more than current balance (${formatCurrency(currentBalance)})`, 'error');
                return;
            }
            
            try {
                const userRef = doc(db, 'users', currentEditUser.id);
                await updateDoc(userRef, {
                    balance: increment(-amount),
                    updatedAt: serverTimestamp()
                });
                
                // Update local state
                currentEditUser.balance = currentBalance - amount;
                currentBalanceDisplay.textContent = formatCurrency(currentEditUser.balance);
                
                // Send notification to user
                await sendNotification(currentEditUser.id, 'Balance Deducted', `Admin has deducted ${formatCurrency(amount)} from your balance.`);
                
                showMessage(adminMessage, `Subtracted ${formatCurrency(amount)} from user balance`, 'success');
                balanceAmountInput.value = '';
                
            } catch (error) {
                console.error('Error subtracting balance:', error);
                showMessage(adminMessage, `Error: ${error.message}`, 'error');
            }
        }

        // Save Balance Changes
        async function saveBalanceChanges() {
            closeEditBalanceModal();
            showMessage(adminMessage, 'Balance changes saved', 'success');
        }

        // Close Edit Balance Modal
        function closeEditBalanceModal() {
            editBalanceModal.classList.remove('active');
            currentEditUser = null;
            balanceAmountInput.value = '';
        }

        // Force Start Earning
        async function forceStartEarning(userId) {
            if (!confirm('Force start earning for this user?')) {
                return;
            }
            
            try {
                const userRef = doc(db, 'users', userId);
                await updateDoc(userRef, {
                    isEarning: true,
                    updatedAt: serverTimestamp()
                });
                
                // Send notification to user
                await sendNotification(userId, 'Earning Started', 'Admin has started earning for your account.');
                
                showMessage(adminMessage, 'User earning started', 'success');
                
            } catch (error) {
                console.error('Error starting user earning:', error);
                showMessage(adminMessage, `Error: ${error.message}`, 'error');
            }
        }

        // Force Stop Earning
        async function forceStopEarning(userId) {
            if (!confirm('Force stop this user from earning?')) {
                return;
            }
            
            try {
                const userRef = doc(db, 'users', userId);
                await updateDoc(userRef, {
                    isEarning: false,
                    updatedAt: serverTimestamp()
                });
                
                // Send notification to user
                await sendNotification(userId, 'Earning Stopped', 'Admin has stopped earning for your account.');
                
                showMessage(adminMessage, 'User earning stopped', 'success');
                
            } catch (error) {
                console.error('Error stopping user earning:', error);
                showMessage(adminMessage, `Error: ${error.message}`, 'error');
            }
        }

        // Ban User
        async function banUser(userId) {
            if (!confirm('Ban this user? They will not be able to login or earn.')) {
                return;
            }
            
            try {
                const userRef = doc(db, 'users', userId);
                await updateDoc(userRef, {
                    banned: true,
                    isEarning: false,
                    updatedAt: serverTimestamp()
                });
                
                // Send notification to user
                await sendNotification(userId, 'Account Banned', 'Your account has been banned by admin.');
                
                showMessage(adminMessage, 'User banned successfully', 'success');
                
            } catch (error) {
                console.error('Error banning user:', error);
                showMessage(adminMessage, `Error: ${error.message}`, 'error');
            }
        }

        // Unban User
        async function unbanUser(userId) {
            if (!confirm('Unban this user?')) {
                return;
            }
            
            try {
                const userRef = doc(db, 'users', userId);
                await updateDoc(userRef, {
                    banned: false,
                    updatedAt: serverTimestamp()
                });
                
                // Send notification to user
                await sendNotification(userId, 'Account Unbanned', 'Your account has been unbanned by admin.');
                
                showMessage(adminMessage, 'User unbanned successfully', 'success');
                
            } catch (error) {
                console.error('Error unbanning user:', error);
                showMessage(adminMessage, `Error: ${error.message}`, 'error');
            }
        }

        // Update Stats
        function updateStats() {
            // Calculate stats from real data
            const totalUsersCount = allUsers.length;
            const sellersCount = allUsers.filter(user => user.role === 'seller' || user.planActive === true).length;
            
            const pendingSellerReqs = allSellerRequests.filter(req => req.status === 'pending').length;
            const pendingWithdraws = allWithdrawRequests.filter(req => req.status === 'pending').length;
            
            const revenue = allSellerRequests
                .filter(req => req.status === 'approved')
                .reduce((sum, req) => sum + (req.amount || 0), 0);
            
            const paidOut = allWithdrawRequests
                .filter(req => req.status === 'approved')
                .reduce((sum, req) => sum + (req.amount || 0), 0);
            
            // Update UI
            totalUsers.textContent = totalUsersCount;
            totalSellers.textContent = sellersCount;
            pendingSellerRequests.textContent = pendingSellerReqs;
            pendingWithdrawals.textContent = pendingWithdraws;
            totalRevenue.textContent = formatCurrency(revenue);
            totalPaidOut.textContent = formatCurrency(paidOut);
        }

        // Filter Seller Requests
        function filterSellerRequests() {
            const searchTerm = sellerSearch.value.toLowerCase();
            const statusFilter = sellerStatusFilter.value;
            
            let filtered = allSellerRequests;
            
            if (searchTerm) {
                filtered = filtered.filter(req => 
                    (req.name && req.name.toLowerCase().includes(searchTerm)) ||
                    (req.email && req.email.toLowerCase().includes(searchTerm)) ||
                    (req.entered_upi && req.entered_upi.toLowerCase().includes(searchTerm))
                );
            }
            
            if (statusFilter !== 'all') {
                filtered = filtered.filter(req => req.status === statusFilter);
            }
            
            updateSellerRequestsTable(filtered);
        }

        // Filter Withdraw Requests
        function filterWithdrawRequests() {
            const searchTerm = withdrawSearch.value.toLowerCase();
            const statusFilter = withdrawStatusFilter.value;
            
            let filtered = allWithdrawRequests;
            
            if (searchTerm) {
                filtered = filtered.filter(req => 
                    (req.name && req.name.toLowerCase().includes(searchTerm)) ||
                    (req.email && req.email.toLowerCase().includes(searchTerm)) ||
                    (req.upi && req.upi.toLowerCase().includes(searchTerm))
                );
            }
            
            if (statusFilter !== 'all') {
                filtered = filtered.filter(req => req.status === statusFilter);
            }
            
            updateWithdrawRequestsTable(filtered);
        }

        // Filter Users
        function filterUsers() {
            const searchTerm = userSearch.value.toLowerCase();
            const roleFilter = userRoleFilter.value;
            const statusFilter = userStatusFilter.value;
            
            let filtered = allUsers;
            
            if (searchTerm) {
                filtered = filtered.filter(user => 
                    (user.name && user.name.toLowerCase().includes(searchTerm)) ||
                    (user.email && user.email.toLowerCase().includes(searchTerm))
                );
            }
            
            if (roleFilter !== 'all') {
                if (roleFilter === 'seller') {
                    filtered = filtered.filter(user => user.role === 'seller' || user.planActive === true);
                } else {
                    filtered = filtered.filter(user => user.role === 'free' || !user.role);
                }
            }
            
            if (statusFilter !== 'all') {
                if (statusFilter === 'earning') {
                    filtered = filtered.filter(user => user.isEarning === true);
                } else if (statusFilter === 'banned') {
                    filtered = filtered.filter(user => user.banned === true);
                } else if (statusFilter === 'active') {
                    filtered = filtered.filter(user => user.banned !== true);
                }
            }
            
            updateUsersTable(filtered);
        }

        // Switch Tab
        function switchTab(tabName) {
            // Update tab buttons
            tabBtns.forEach(btn => {
                if (btn.dataset.tab === tabName) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Update tab content
            Object.keys(tabContents).forEach(tab => {
                if (tab === tabName) {
                    tabContents[tab].style.display = 'block';
                } else {
                    tabContents[tab].style.display = 'none';
                }
            });
        }

        // Show Notification Modal
        function showNotificationModal() {
            notificationTitle.value = '';
            notificationMessage.value = '';
            notificationUid.value = '';
            notificationTarget.value = 'ALL';
            specificUserGroup.style.display = 'none';
            notificationModal.classList.add('active');
        }

        // Send Notification Submit
        async function sendNotificationSubmit() {
            const target = notificationTarget.value;
            const title = notificationTitle.value.trim();
            const message = notificationMessage.value.trim();
            const uid = notificationUid.value.trim();
            
            if (!title) {
                showMessage(adminMessage, 'Please enter notification title', 'error');
                return;
            }
            
            if (!message) {
                showMessage(adminMessage, 'Please enter notification message', 'error');
                return;
            }
            
            if (target === 'specific' && !uid) {
                showMessage(adminMessage, 'Please enter user UID', 'error');
                return;
            }
            
            try {
                sendNotificationSubmitBtn.innerHTML = '<span class="loader"></span>Sending...';
                sendNotificationSubmitBtn.disabled = true;
                
                const sendTo = target === 'ALL' ? 'ALL' : uid;
                await sendNotification(sendTo, title, message);
                
                sendNotificationSubmitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send Notification';
                sendNotificationSubmitBtn.disabled = false;
                
                notificationModal.classList.remove('active');
                
            } catch (error) {
                console.error('Error sending notification:', error);
                sendNotificationSubmitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send Notification';
                sendNotificationSubmitBtn.disabled = false;
            }
        }

        // Close Modal
        function closeModal() {
            requestModal.classList.remove('active');
            currentModalData = null;
            currentModalType = null;
        }

        // Setup Admin UI
        function setupAdminUI(user) {
            currentAdmin = user;
            
            // Update admin info
            adminEmail.textContent = user.email || 'No email';
            if (user.photoURL) {
                adminAvatarImg.src = user.photoURL;
                adminAvatarImg.style.display = 'block';
                adminAvatarText.style.display = 'none';
            } else {
                adminAvatarText.textContent = user.displayName ? user.displayName.charAt(0).toUpperCase() : 'A';
                adminAvatarImg.style.display = 'none';
                adminAvatarText.style.display = 'block';
            }
            
            // Show admin dashboard
            loginScreen.style.display = 'none';
            adminDashboard.style.display = 'block';
            
            // Load all data
            loadGlobalSettings();
            loadSellerRequests();
            loadWithdrawRequests();
            loadUsers();
        }

        // Cleanup Listeners
        function cleanupListeners() {
            Object.keys(unsubscribeCallbacks).forEach(key => {
                if (unsubscribeCallbacks[key]) {
                    unsubscribeCallbacks[key]();
                    unsubscribeCallbacks[key] = null;
                }
            });
        }

        // Event Listeners
        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                switchTab(btn.dataset.tab);
            });
        });

        sellerSearch.addEventListener('input', filterSellerRequests);
        sellerStatusFilter.addEventListener('change', filterSellerRequests);
        withdrawSearch.addEventListener('input', filterWithdrawRequests);
        withdrawStatusFilter.addEventListener('change', filterWithdrawRequests);
        userSearch.addEventListener('input', filterUsers);
        userRoleFilter.addEventListener('change', filterUsers);
        userStatusFilter.addEventListener('change', filterUsers);

        saveSettingsBtn.addEventListener('click', saveGlobalSettings);
        
        notificationTarget.addEventListener('change', function() {
            if (this.value === 'specific') {
                specificUserGroup.style.display = 'flex';
            } else {
                specificUserGroup.style.display = 'none';
            }
        });

        // Modal Close
        modalCloseBtn.addEventListener('click', closeModal);
        requestModal.addEventListener('click', (e) => {
            if (e.target === requestModal) {
                closeModal();
            }
        });
        
        notificationModalCloseBtn.addEventListener('click', () => {
            notificationModal.classList.remove('active');
        });
        
        notificationModal.addEventListener('click', (e) => {
            if (e.target === notificationModal) {
                notificationModal.classList.remove('active');
            }
        });
        
        editBalanceModalCloseBtn.addEventListener('click', closeEditBalanceModal);
        
        editBalanceModal.addEventListener('click', (e) => {
            if (e.target === editBalanceModal) {
                closeEditBalanceModal();
            }
        });

        // Send Notification
        sendNotificationBtn.addEventListener('click', showNotificationModal);
        sendNotificationSubmitBtn.addEventListener('click', sendNotificationSubmit);

        // Google Login
        googleLoginBtn.addEventListener('click', async () => {
            try {
                googleLoginBtn.innerHTML = '<span class="loader"></span>Signing in...';
                googleLoginBtn.disabled = true;
                
                const result = await signInWithPopup(auth, googleProvider);
                console.log('Admin login successful:', result.user.email);
                
            } catch (error) {
                console.error('Login error:', error);
                showMessage(loginMessage, `Login failed: ${error.message}`, 'error');
                
                googleLoginBtn.innerHTML = '<i class="fab fa-google"></i> Sign in with Google';
                googleLoginBtn.disabled = false;
            }
        });

        // Logout
        logoutBtn.addEventListener('click', async () => {
            try {
                // Cleanup listeners
                cleanupListeners();
                
                await signOut(auth);
                
                // Reset state
                currentAdmin = null;
                
                // Show login screen
                loginScreen.style.display = 'flex';
                adminDashboard.style.display = 'none';
                
                googleLoginBtn.innerHTML = '<i class="fab fa-google"></i> Sign in with Google';
                googleLoginBtn.disabled = false;
                
            } catch (error) {
                console.error('Logout error:', error);
                showMessage(adminMessage, 'Logout failed', 'error');
            }
        });

        // Auth State Observer
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // ANY logged-in user can access admin (temporary)
                setupAdminUI(user);
            } else {
                // User signed out
                currentAdmin = null;
                loginScreen.style.display = 'flex';
                adminDashboard.style.display = 'none';
                cleanupListeners();
            }
        });

        // Expose functions to window
        window.switchTab = switchTab;
        window.copyText = copyToClipboard;
        window.showRequestDetails = showRequestDetails;
        window.approveSellerRequest = approveSellerRequest;
        window.rejectSellerRequest = rejectSellerRequest;
        window.removeSellerPlan = removeSellerPlan;
        window.approveWithdrawRequest = approveWithdrawRequest;
        window.rejectWithdrawRequest = rejectWithdrawRequest;
        window.refundWithdrawRequest = refundWithdrawRequest;
        window.editUserBalance = editUserBalance;
        window.addBalance = addBalance;
        window.subtractBalance = subtractBalance;
        window.saveBalanceChanges = saveBalanceChanges;
        window.closeEditBalanceModal = closeEditBalanceModal;
        window.forceStartEarning = forceStartEarning;
        window.forceStopEarning = forceStopEarning;
        window.banUser = banUser;
        window.unbanUser = unbanUser;

        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Data Seller Admin Panel Initialized');
            
            // Ensure body is scrollable
            document.body.style.overflowY = 'auto';
        });

    </script>
</body>
</html>